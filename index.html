<!DOCTYPE html>
<html>
<head>
<title>Myth 蜜絲雲端髮藝網</title>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
<meta name="viewport" content="user-scalable=no, initial-scale=1" />
</head>
<link rel="stylesheet" href="bootstrap-3.3.4/css/bootstrap.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="bootstrap-3.3.4/js/bootstrap.min.js"></script>
<script src="js/jquery.validate.js"></script>
<script src="js/additional-methods.js"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript">
var app = {
  initialize: function() {
    this.bindEvents();
  },
  // Bind any events that are required on startup. Common events are:
  // 'load', 'deviceready', 'offline', and 'online'.
  bindEvents: function() {
    document.addEventListener('deviceready', this.onDeviceReady, false);
  },
  // deviceready Event Handler
  //
  // The scope of 'this' is the event. In order to call the 'receivedEvent'
  // function, we must explicitly call 'app.receivedEvent(...);'
  onDeviceReady: function() {
    var push = PushNotification.init({
      "android": {"senderID": "100971030124"},
      "ios": {"alert": "true", "badge": "true", "sound": "true"}, 
      "windows": {}
    });
    push.on('registration', function(data) {
      $("input[name=RegistrationID]").val(data.registrationId);
    }).on('notification', function(data) {
    }).on('error', function(e) {
      console.log("push error");
    });
  }
};
app.initialize();

$(document).ready(function(){
  $("#Form_Register").validate();
  $("#Form_Login").validate();
});

// Normal login
function LoginSubmit(Type) {
  if($("#Form_" + Type).valid()) {
    $.post('http://myth-hair.frog.tw/login.php', $("#Form_" + Type).serialize(), function(data, status){
      if(status == "success") {
        $("#Alert_" + Type).html(data);
        return true;
      }
    });
  }
  return false;
}

function FBLoginSubmit(Type) {
  facebookConnectPlugin.login(["public_profile", "email"],
    fbLoginSuccess,
    function (error) { alert("" + error) }
  );
  
  var fbLoginSuccess = function (userData) {
    alert("fbLoginSuccess");
    $.post('http://myth-hair.frog.tw/login_FB.php', $("#Form_" + Type).serialize(), function(data, status){
      if(status == "success") {
        $("#Alert_" + Type).html(data);
        return true;
      }
    });
    alert("UserInfo: " + JSON.stringify(userData));
    facebookConnectPlugin.getAccessToken(function(token) {
        alert("Token: " + token);
    }, function(err) {
        alert("Could not get access token: " + err);
    });
  }
}
</script>
<style>
.form-group {margin-bottom: 5px}
</style>

<body>
<h2 class="text-center">Myth 蜜絲髮藝</h2>
<div id="Div_Register" class="container collapse in">
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1">
      <form class="form-horizontal" id="Form_Register">
      <input type="hidden" name="Type" value="Register" />
      <input type="hidden" name="RegistrationID" value="" />
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-user form-control-feedback" style="left:25px"></span>
          <select class="form-control" style="padding-left:40px; padding-right:12px" name="Role">
          <option value="customer">消費者</option>
          <option value="hairdresser">設計師</option>
          </select>
        </div>
      </div>
      <hr />
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
          <input type="email" class="form-control email required" name="Account" placeholder="Email" />
        </div>
      </div>
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-lock form-control-feedback"></span>
          <input type="password" class="form-control required" name="Password" placeholder="密碼" id="Password_Register" />
        </div>
      </div>
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-eye-open form-control-feedback"></span>
          <input type="text" class="form-control required" name="Name" placeholder="稱呼" />
        </div>
      </div>
      <p class="text-center"><button type="button" class="btn btn-primary btn-block" onClick="LoginSubmit('Register')" />註冊</button></p>
      <hr />
      <p class="text-center"><button type="button" class="btn btn-primary btn-block" onClick="FBLoginSubmit('Register')"><img src="https://www.facebookbrand.com/img/facebook.icon.png"> 使用 Facebook 註冊</button></p>
      <div id="Alert_Register"></div>
      <p class="text-center"><button type="button" class="btn btn-link" onclick="$('#Div_Register').fadeOut(300, function(){ $('#Div_Login').fadeIn(300); });">已經有帳號? 按此登入</button></p>
      </form>
    </div>
  </div>
</div>
<div id="Div_Login" class="container collapse">
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1">
      <form class="form-horizontal" id="Form_Login">
      <input type="hidden" name="Type" value="Login" />
      <input type="hidden" name="RegistrationID" value="" />
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
          <input type="email" class="form-control email required" name="Account" placeholder="Email" />
        </div>
      </div>
      <div class="form-group has-feedback">
        <div class="col-xs-12">
          <span class="glyphicon glyphicon-lock form-control-feedback"></span>
          <input type="password" class="form-control required" name="Password" placeholder="密碼" />
        </div>
      </div>
      <p class="text-center"><button type="button" class="btn btn-primary btn-block" onClick="LoginSubmit('Login')" />登入</button></p>
      <hr />
      <p class="text-center"><button type="button" class="btn btn-primary btn-block" onClick="FBLoginSubmit('Login')"><img src="https://www.facebookbrand.com/img/facebook.icon.png"> 使用 Facebook 登入</button></p>
      <div id="Alert_Login"></div>
      <p class="text-center"><button type="button" class="btn btn-link" onclick="$('#Div_Login').fadeOut(300, function(){ $('#Div_Register').fadeIn(300); });">註冊新帳號</button></p>
      </form>
    </div>
  </div>
</div>
</body>
</html>
